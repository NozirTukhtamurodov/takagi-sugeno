#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ —Å –Ω–∏–∑–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏–∑ –¥–∞–Ω–Ω—ã—Ö.
"""

import pandas as pd
import numpy as np

# ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
INPUT_FILE = "train.csv"
OUTPUT_FILE = "train_filtered.csv"
SEPARATOR = ","
DECIMAL = "."

# –ö–ª–∞—Å—Å—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (—Å —Ç–æ—á–Ω–æ—Å—Ç—å—é < 70%)
# –ù–æ–º–µ—Ä–∞ –∫–ª–∞—Å—Å–æ–≤ –∫–∞–∫ –≤ –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ú —Ñ–∞–π–ª–µ (1-116)
BAD_CLASSES = [
    1, 2, 3, 4, 5,
    
    # –ö–ª–∞—Å—Å_16 - –ö–ª–∞—Å—Å_27 (—á–∞—Å—Ç–∏—á–Ω–æ –ø–ª–æ—Ö–∏–µ, –Ω–æ –æ—Å—Ç–∞–≤–∏–º –ª—É—á—à–∏–µ)
    17, 18, 19, 20,21, 24, 25, 26, 27, 28, 29,  # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    
    # –ö–ª–∞—Å—Å_36 - –ö–ª–∞—Å—Å_49 (–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ 37-50)
    37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,
    
    # –ö–ª–∞—Å—Å_50 - –ö–ª–∞—Å—Å_73 (–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ 51-74)
    51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 
    65, 66, 67, 68, 69, 70, 71, 72, 73, 74,
    
    # –ö–ª–∞—Å—Å_77, –ö–ª–∞—Å—Å_78 (–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ 78, 79)
    78, 79,
    
        # –ö–ª–∞—Å—Å_82 (–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ 83)
        83,85,86,
        
        # –ö–ª–∞—Å—Å_97, –ö–ª–∞—Å—Å_98, –ö–ª–∞—Å—Å_100, –ö–ª–∞—Å—Å_101 (–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ 98, 99, 101, 102)
        94,95,98, 99, 101, 102,
        
        # –ö–ª–∞—Å—Å_105 - –ö–ª–∞—Å—Å_107 (–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ 106-108)
        106, 107, 108,
        
        # –ö–ª–∞—Å—Å_114 (–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ 115)
        115,116
    ]

# ========== –û–ë–†–ê–ë–û–¢–ö–ê ==========
print("=" * 60)
print("–§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ö–õ–ê–°–°–û–í –° –ù–ò–ó–ö–û–ô –¢–û–ß–ù–û–°–¢–¨–Æ")
print("=" * 60)

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
print(f"\nüìÅ –ó–∞–≥—Ä—É–∑–∫–∞: {INPUT_FILE}")
data = pd.read_csv(INPUT_FILE, sep=SEPARATOR, decimal=DECIMAL, header=None)
print(f"   –†–∞–∑–º–µ—Ä: {data.shape[0]} —Å—Ç—Ä–æ–∫ √ó {data.shape[1]} —Å—Ç–æ–ª–±—Ü–æ–≤")

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–∞—Ö
y = data.iloc[:, -1].values
unique_classes = np.unique(y)
print(f"   –ö–ª–∞—Å—Å–æ–≤: {len(unique_classes)} (–æ—Ç {y.min()} –¥–æ {y.max()})")

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
print(f"\nüìä –ö–ª–∞—Å—Å–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: {len(BAD_CLASSES)}")
print(f"   –°–ø–∏—Å–æ–∫: {BAD_CLASSES[:10]}... (–ø–µ—Ä–≤—ã–µ 10)")

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
mask = ~data.iloc[:, -1].isin(BAD_CLASSES)
data_filtered = data[mask].copy()

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
y_filtered = data_filtered.iloc[:, -1].values
unique_filtered = np.unique(y_filtered)

print(f"\n‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢:")
print(f"   –£–¥–∞–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫: {len(data) - len(data_filtered)}")
print(f"   –û—Å—Ç–∞–ª–æ—Å—å —Å—Ç—Ä–æ–∫: {len(data_filtered)}")
print(f"   –û—Å—Ç–∞–ª–æ—Å—å –∫–ª–∞—Å—Å–æ–≤: {len(unique_filtered)}")
print(f"   –ö–ª–∞—Å—Å—ã: –æ—Ç {y_filtered.min()} –¥–æ {y_filtered.max()}")

# –ù–ï –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º - –æ—Å—Ç–∞–≤–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –∫–ª–∞—Å—Å–æ–≤

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
print(f"\nüíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: {OUTPUT_FILE}")
data_filtered.to_csv(OUTPUT_FILE, sep=SEPARATOR, decimal=DECIMAL, header=False, index=False)

print(f"\n‚úÖ –ì–æ—Ç–æ–≤–æ!")
print(f"   –û–±–Ω–æ–≤–∏—Ç–µ config.py:")
print(f'   DATA_FILE = "{OUTPUT_FILE}"')
print(f'   DATA_SEPARATOR = "{SEPARATOR}"')
print(f'   DATA_DECIMAL = "{DECIMAL}"')
print("=" * 60)
